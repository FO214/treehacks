import h from"fs";import k from"os";import i from"path";function d(){try{let p=process.env.XDG_CONFIG_HOME?i.join(process.env.XDG_CONFIG_HOME,"poke"):i.join(k.homedir(),".config","poke"),e=h.readFileSync(i.join(p,"credentials.json"),"utf-8");return JSON.parse(e).token??void 0}catch{return}}var a=class{apiKey;baseUrl;constructor(e){let s=e?.apiKey??process.env.POKE_API_KEY??d();if(!s)throw new Error(["Missing API key. Find yours at https://poke.com/kitchen/api-keys","","Provide it in one of three ways:",'  1. new Poke({ apiKey: "pk_..." })',"  2. Set the POKE_API_KEY environment variable","  3. Run `poke login` in your terminal"].join(`
`));this.apiKey=s,this.baseUrl=e?.baseUrl??process.env.POKE_API??"https://poke.com/api/v1"}async request({path:e,body:s}){let o=await fetch(`${this.baseUrl}${e}`,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(!o.ok){let t=await o.text(),n="";try{let r=JSON.parse(t);n=r.error??r.message??""}catch{}throw o.status===401?new Error("Poke: Invalid API key. Get a new one at https://poke.com/kitchen/api-keys"):o.status===403?new Error("Poke: API key doesn't have permission for this action. Check your key scopes at https://poke.com/kitchen/api-keys"):o.status===429?new Error("Poke: Rate limited. Please slow down and retry."):new Error(`Poke API error (${o.status}): ${n||o.statusText}`)}return o.json()}async sendMessage(e){return this.request({path:"/inbound/api-message",body:{message:e}})}async sendWebhook({webhookUrl:e,webhookToken:s,data:o}){let t=await fetch(e,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(o)});if(!t.ok){let n=await t.text(),r="";try{let c=JSON.parse(n);r=c.error??c.message??""}catch{}throw new Error(`Poke webhook error (${t.status}): ${r||t.statusText}`)}return t.json()}async createWebhook({condition:e,action:s}){return this.request({path:"/api-keys/webhook",body:{condition:e,action:s}})}};export{a as Poke};
