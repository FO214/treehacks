"use strict";var u=Object.create;var a=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var w=Object.getPrototypeOf,P=Object.prototype.hasOwnProperty;var f=(s,e)=>{for(var o in e)a(s,o,{get:e[o],enumerable:!0})},d=(s,e,o,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of m(e))!P.call(s,r)&&r!==o&&a(s,r,{get:()=>e[r],enumerable:!(t=b(e,r))||t.enumerable});return s};var h=(s,e,o)=>(o=s!=null?u(w(s)):{},d(e||!s||!s.__esModule?a(o,"default",{value:s,enumerable:!0}):o,s)),l=s=>d(a({},"__esModule",{value:!0}),s);var S={};f(S,{Poke:()=>c});module.exports=l(S);var y=h(require("fs"),1),g=h(require("os"),1),p=h(require("path"),1);function O(){try{let s=process.env.XDG_CONFIG_HOME?p.default.join(process.env.XDG_CONFIG_HOME,"poke"):p.default.join(g.default.homedir(),".config","poke"),e=y.default.readFileSync(p.default.join(s,"credentials.json"),"utf-8");return JSON.parse(e).token??void 0}catch{return}}var c=class{apiKey;baseUrl;constructor(e){let o=e?.apiKey??process.env.POKE_API_KEY??O();if(!o)throw new Error(["Missing API key. Find yours at https://poke.com/kitchen/api-keys","","Provide it in one of three ways:",'  1. new Poke({ apiKey: "pk_..." })',"  2. Set the POKE_API_KEY environment variable","  3. Run `poke login` in your terminal"].join(`
`));this.apiKey=o,this.baseUrl=e?.baseUrl??process.env.POKE_API??"https://poke.com/api/v1"}async request({path:e,body:o}){let t=await fetch(`${this.baseUrl}${e}`,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify(o)});if(!t.ok){let r=await t.text(),i="";try{let n=JSON.parse(r);i=n.error??n.message??""}catch{}throw t.status===401?new Error("Poke: Invalid API key. Get a new one at https://poke.com/kitchen/api-keys"):t.status===403?new Error("Poke: API key doesn't have permission for this action. Check your key scopes at https://poke.com/kitchen/api-keys"):t.status===429?new Error("Poke: Rate limited. Please slow down and retry."):new Error(`Poke API error (${t.status}): ${i||t.statusText}`)}return t.json()}async sendMessage(e){return this.request({path:"/inbound/api-message",body:{message:e}})}async sendWebhook({webhookUrl:e,webhookToken:o,data:t}){let r=await fetch(e,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){let i=await r.text(),n="";try{let k=JSON.parse(i);n=k.error??k.message??""}catch{}throw new Error(`Poke webhook error (${r.status}): ${n||r.statusText}`)}return r.json()}async createWebhook({condition:e,action:o}){return this.request({path:"/api-keys/webhook",body:{condition:e,action:o}})}};0&&(module.exports={Poke});
